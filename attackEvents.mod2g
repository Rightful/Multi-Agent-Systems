use UTbot as knowledge.
use Action as actionspec.

order = linearall.

module attackEvents {
	
	% Belief base cleaning.
	forall bel(lookingAt(Target)) do delete(lookingAt(Target)).
	 	
	% Updating where to look.
	if bel(not(enemyBot(_, _)), timeForUpdate, lookAt(LOC, X), viewAngle(Y), lastAngleUpdater(LastAngle), get_time(Current)) 
		then look([nearestEnemy,LOC]) + delete(lastAngleUpdater(LastAngle)) + insert(lastAngleUpdater(Current)) + delete(viewAngle(Y)) + insert(viewAngle(X)).
	
	% if we're shot at but dont see anyone, look at where you came from
	 if percept(status(NewHealth,_)), bel(status(OldHealth,_), NewHealth < OldHealth, not(enemyBot(_,_)), ownLocation(A,B,C))  then look(location(A,B,C)).
	
	% If bot sees enemy bot.
	if bel(enemyBot(_, LOC)) then look(LOC).	
	
	% keep track of own location.
	if bel(ownLocation(OldX,OldY,OldZ)),percept(orientation(location(X,Y,Z),_,_)) then delete(ownLocation(OldX,OldY,OldZ))+insert(ownLocation(X,Y,Z)).
	
	% Update the orientation of the bot
	forall bel(orientation(location(X,Y,Z),OldRot,OldVel), prevLocation(X1,Y1,Z1)), percept(orientation(Loc,Rot,Vel)) do
		delete(prevLocation(X1,Y1,Z1)) + insert(prevLocation(X,Y,Z)) + delete(orientation(location(X,Y,Z),OldRot,OldVel)) + insert(orientation(Loc,Rot,Vel)).
		
	% Update the bot's status
	forall bel(status(OldHp,OldArm)), percept(status(Hp,Arm,_,_)) do
		delete(status(OldHp,OldArm)) + insert(status(Hp,Arm)).
		
	% Update the bot's current weapon
	forall bel(currentWeapon(OldWeap,OldFMode)), percept(currentWeapon(Weap,FMode)) do
		delete(currentWeapon(OldWeap,OldFMode)) + insert(currentWeapon(Weap,FMode)).
		
	% Update the bot's inventory
	if percept(not(weapon(WeapType,Ammo,AltAmmo))), bel(weapon(WeapType,Ammo,AltAmmo)) then delete(weapon(WeapType,Ammo,AltAmmo)).
	if percept(weapon(WeapType,Ammo,AltAmmo)) then insert(weapon(WeapType,Ammo,AltAmmo)).
		
	% Update the bot's current powerup
	forall bel(powerup(OldType,OldDur)), percept(powerup(Type,Dur)) do
		delete(powerup(OldType,OldDur)) + insert(powerup(Type,Dur)).
		
	% Update the bot's current armor
	forall bel(armor(OldHelm,OldVest,OldPads,OldBelt)), percept(armor(Helm,Vest,Pads,Belt)) do
		delete(armor(OldHelm,OldVest,OldPads,OldBelt)) + insert(armor(Helm,Vest,Pads,Belt)).
		
	% Store all kills made in the match
	forall percept(fragged(Time,KillerID,VictimID,WeapType)) do insert(fragged(Time,KillerID,VictimID,WeapType)).
	
	% Update the navigation state of the bot ('send on change' percept).
	forall bel(navigation(OldStatus,OldDest)), percept(navigation(Status,Destination))do 
		delete(navigation(OldStatus,OldDest)) + insert(navigation(Status,Destination)).
	
	% Updates the flag information.
	forall percept(not(flag(Team , HolderID , Position))), bel(flag(Team , HolderID , Position)) do delete(flag(Team , HolderID , Position)).
	forall percept(flag(Team , HolderID , Position)) do insert(flag(Team , HolderID , Position)).
	
	% Updates the flag state.
	forall percept(not(flagState(Team,FlagState))) do delete(flagState(Team,FlagState)).
	forall percept(flagState(Team,FlagState)) do insert(flagState(Team,FlagState)).

	% Handle the path percept from the path action
	forall percept(path(StartID,EndID,Len,Loc)) do insert(path(StartID,EndID,Len,Loc)).
	
	% Update the items the bot sees and drop any getItem goals associated with them.
	forall percept(not(item(UnrealID,Label,ItemType,Position))) do delete(item(UnrealID,Label,ItemType,Position)) + drop(goLocation(UnrealID)).
	forall percept(item(UnrealID,Label,ItemType,Position)) do insert(item(UnrealID,Label,ItemType,Position)).
	
	% Update the other bots the bot sees.
	forall percept(not(bot(UnrealID,Name,Team,Position,Weapon,Firemode))) do delete(bot(UnrealID,Name,Team,Position,Weapon,Firemode)).
	forall percept(bot(UnrealID,Name,Team,Position,Weapon,Firemode)) do insert(bot(UnrealID,Name,Team,Position,Weapon,Firemode)).
	
	% Update the pickups the bot sees.
	forall percept(not(pickup(UnrealID))) do delete(pickup(UnrealID)).
	forall percept(pickup(UnrealID)) do insert(pickup(UnrealID)).
	
	% Update the slowVolumes the bot sees.
	forall percept(not(slowVolume([UnrealID]))) do delete(slowVolume([UnrealID])).
	forall percept(slowVolume([UnrealID])) do insert(slowVolume([UnrealID])).
	
	%if someone sends me the location  I put it in my believe base as lastknownFlagLoc
	if (_).sent(locationOfFlag(X,Y,Z)), bel(lastKnownLocFlag(location(Q,W,R))) then delete(lastKnownLocFlag(location(Q,W,R))) +insert(lastKnownLocFlag(location(X,Y,Z))).

	%if bel(self(MyID, _, Team), flag(Team2, MyID, location(X,Y,Z)), Team\=Team2) then allother.send!(locationOfFlag(X,Y,Z)).

	% if we hold the flag then send to other escort
	if bel(holdingFlag) then allother.send:(escort).
	
	if bel(holdingFlag, status(H, _), ownLocation(X,Y,Z), H < 20 )then allother.send!(help(location(X,Y,Z))).
	
	% if someone send escort then insert escort
	if (_).sent:(escort), bel(not(holdingFlag)) then insert(escort).
	
	if (_).sent!(help(UnrealID)), bel(not(holdingFlag)) then adopt(goHelp(UnrealID)).

	if bel(flagState(Team, 'dropped'), self(_,_, Team2), Team \= Team2) then delete(escort).
	
	if not(a-goal(escort)), bel(enemyBaseLocation(Location), flagState(Team, 'home'), self(_,_, Team2), Team \= Team2) then adopt(goLocationFlag(Location)).
	
	% if flag of opponent is already held then drop the goal to be at the flag base.
	forall a-goal(goLocationFlagEnemy(Location)), bel(escort) do drop(goLocationFlagEnemy(Location)).

	%If we are not the escort , but the flag is taken , adopt the escort goal.
	if not(a-goal(escort)) ,bel(flagState(Team2 , held), flagState(Team , home),flag(Team2,ID,_) ,self(ID2,_,Team),ID\=ID2, Team\=Team2) then adopt(escort).

	%if we see the flag , go there.
	if bel(not(enemyBaseLocation(POSBase)), flag(Team,none,POS), self(_,_,Team2), Team\=Team2 , POS\=POSBase) then adopt(goLocationFlag(POS)).	
	
	% If we have the flag , go back to base.
	if bel(ourBaseLocation(Location), self(MyID, _, Team), flag(Team2, MyID, _), Team\=Team2) then adopt(goHomeWithFlag(Location)).

	%if we  have the location of a flag from a  teammate go to there.
	if a-goal(escort), bel (lastKnownLocFlag(Pos)) then adopt (goHelp(Pos)).

	% if the bot holds the flag he cant be the escort
	if bel(flag(Team2,Player,_), self(Player,_,Team), Team \= Team2) then delete(escort).
	
	%If we are holding the flag , send to other bots our location. thus 
	if bel(holdingFlag, ownLocation(X,Y,Z), not(escort)) then allother.send(locationOfFlag(X,Y,Z)).
	
	%if someone sends me the location  I put it in my believe base as lastknownFlagLoc
	if (_).sent(locationOfFlag(X,Y,Z) ), bel(escort)then adopt(goEscort(location(X,Y,Z))).
	
	% if the flag of the enemy is dropped or at home, then the last location of the flag arent valid
	forall bel(lastKnownLocFlag(Location),(flagState(Team, 'home')), self(_,_,Team2), Team\=Team2) do delete(lastKnownLocFlag(Location)).	
	forall bel(lastKnownLocFlag(Location),(flagState(Team, 'dropped')), self(_,_,Team2), Team\=Team2) do delete(lastKnownLocFlag(Location)).
	
	% If we have the flag , go back to base.
	if bel(ourBaseLocation(Home), holdingFlag) then adopt(goHomeWithFlag(Home)).
	
	% Not stable yet
	forall bel(atkRad(UnrealID), flagState(Team, 'dropped'), self(_,_, Team2), Team \= Team2, not(flag(_,_,_)) ) 
		do adopt(goRandom(UnrealID)).
	
	forall a-goal(goGrabEnemy(Location)), bel(holdingFlag) do drop(goGrabEnemy(Location)).
	forall a-goal(goEscort(Location)), bel(holdingFlag) do drop(goEscort(Location)).
	forall a-goal(goRandom(Location)), bel(holdingFlag) do drop(goRandom(Location)).
	forall a-goal(pu(X)), bel(holdingFlag) do drop(pu(X)).
	
	%if we were escorting a person , and our flag was taken , the escort should go in killmodus.
	if bel(escort, flagState(Team,held), self(_,_,Team), Team\=Team2) then delete(escort)+  adopt(killModus).
	%drop killModus if our flag is home.
	if a-goal(killModus), bel(flagState(Team, home), self(_,_,Team)) then drop(killModus).		
	
	% if you are not holding the flag anymore than drop the goal to be at our base.
	%if we die send a message to other bots that we died and that the lastknown location is at this position.
	if percept(fragged(_, _, ID, _)), bel(self(ID,_,Team2), flag(Team,_, Location), Team\=Team2)
		then allother.send(lastKnownLocFlag(Location)).
	
	if (_).sent(lastKnownLocFlag(Location))then insert(lastKnownLocFlag(Location)).
	
	if a-goal(at(ID)), bel(ourBaseLocation(ID), not(holdingFlag)) then drop(at(ID)).
	 	
	forall bel(lastKnownLocFlag(Location),(flagState(Team, 'home');flagState(Team, 'held')), self(_,_,Team2), Team\=Team2) 
		do delete(lastKnownLocFlag(Location)).
	
	forall a-goal(goEscort(Location)), bel(flag(Team,none,Location); (flagState(Team, 'home'), self(_,_, Team2), Team \= Team2)) 
		do drop(goEscort(Location)).
	forall a-goal(goHomeWithFlag(Home)), bel(flag(Team,none,Location); (flagState(Team, 'home'), self(_,_, Team2), Team \= Team2)) 
		do drop(goHomeWithFlag(Home)).
	forall a-goal(goRandom(Home)), bel(flag(Team,none,Location); (flagState(Team, 'home'), self(_,_, Team2), Team \= Team2)) 
		do drop(goRandom(Home)).
		
	forall a-goal(goHomeWithFlag(Home)), bel(escort) do drop(goHomeWithFlag(Home)).
	forall a-goal(goRandom(Location)), bel(escort) do drop(goRandom(Location)).
	forall a-goal(goGrabEnemy(Location)), bel(escort) do drop(goGrabEnemy(Location)).
	
	

	% if you have been fragged then delete all (at +  fraggedBot) goals.
	forall a-goal(fraggedBot(A,location(X,Y,Z))), bel(self(Victim,_,_), fragged(_,_,Victim,_)) do drop(fraggedBot(A,location(X,Y,Z))).
	forall a-goal(fraggedBot(A,location(X,Y,Z))), bel(not(enemyBot(A,_))) do drop(fraggedBot(A,location(X,Y,Z))).

	% if you see an opponent bot then adopt to kill that bot.
	 forall bel(enemyBot(UnrealID,location(X,Y,Z))) do adopt(fraggedBot(UnrealID,location(X,Y,Z))).

	% if flag of opponent is already held then drop the goal to be at the flag base.
	forall a-goal(goGrabEnemy(Location)) , bel(flagState(Team2 , held), self(Player, _, Team), Team \=Team2, not(flag(Team2,Player,_)) ) 
		do drop(goGrabEnemy(Location)).
	
	%drop killModus if our flag is home.
	if a-goal(killModus), bel(flagState(Team, home), self(_,_,Team)) then drop(killModus).		

	% If the bot sees the flag, the bot will delete all his next locations and adopt going to the location of the flag.
	forall a-goal(goGrabEnemy(UnrealID)), bel(self(_,_,TeamColor), flag(TeamColor, none, Position), flagState(TeamColor, 'dropped'))
		do drop(goGrabEnemy(UnrealID))+ adopt(goLocationFlag(Position)).
	forall a-goal(goHomeWithFlag(UnrealID)), bel(self(_,_,TeamColor), flag(TeamColor, none, Position), flagState(TeamColor, 'dropped'))
		do drop(goHomeWithFlag(UnrealID))+ adopt(goLocationFlag(Position)).
	forall a-goal(goEscort(UnrealID)), bel(self(_,_,TeamColor), flag(TeamColor, none, Position), flagState(TeamColor, 'dropped'))
		do drop(goEscort(UnrealID))+ adopt(goLocationFlag(Position)).
	
	% If the flag is back at the base the goLocationFlag goal is dropped
	 forall a-goal(goLocationFlag(UnrealID)), bel(self(_,_,TeamColor), flagState(TeamColor, 'home'))do drop(goLocationFlag(UnrealID)).
	
	if a-goal(pu(X), goGrabEnemy(ID)) then drop(pu(X))+ stop + navigate(X) + adopt(goGrabEnemy(ID)).
	if a-goal(pu(X), goRandom(ID)) then drop(pu(X))+ stop + navigate(X) + adopt(goRandom(ID)).
	if a-goal(pu(X), goEscort(ID)) then drop(pu(X))+ stop + navigate(X) + adopt(goEscort(ID)).
	
		
	
	
}